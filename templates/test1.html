<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œê·¸ë¨ ë¹„ìš© ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { background-color: #f4f7fc; font-family: 'Noto Sans KR', sans-serif; padding-top: 20px; color: #333; }
        .dashboard-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .card { border: none; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.05); }
        .card-header { background-color: white; border-bottom: 1px solid #eee; padding: 15px 20px; border-radius: 12px 12px 0 0 !important; }
        
        .table th { background-color: #f8f9fa; vertical-align: middle; text-align: center; font-size: 14px; white-space: nowrap; color: #555; font-weight: 700; }
        .table td { vertical-align: middle; text-align: center; font-size: 14px; white-space: nowrap; color: #444; }
        
        .total-col { background-color: #eef4ff !important; font-weight: bold; color: #0d6efd; }
        .total-row { background-color: #fff8e1 !important; font-weight: bold; border-top: 2px solid #ffc107; }

        /* í˜ì´ì§• ì»¨í…Œì´ë„ˆ */
        #paginationNav { margin-top: 20px; } 
        .pagination { cursor: pointer; margin-bottom: 0; }
        
        #programBadge { font-size: 1.1rem; padding: 8px 15px; display: none; }
    </style>
</head>
<body>

<div class="dashboard-container">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="d-flex align-items-center gap-3">
            <h3 class="fw-bold m-0" id="pageTitle">ğŸ“Š í”„ë¡œê·¸ë¨ë³„ ë¹„ìš© í†µí•© ë¶„ì„</h3>
            <span class="badge bg-primary rounded-pill shadow-sm" id="programBadge">
                ğŸ“º Target: ìì´ì–¸íŠ¸ í­TV
            </span>
        </div>
        
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-primary active" id="btnMain" onclick="switchView('main', 1)">1. í†µí•© ë¹„êµ</button>
            <button type="button" class="btn btn-outline-secondary" id="btnDetail" onclick="switchView('detail')">2. ìƒì„¸ ë¶„ì„</button>
            <button type="button" class="btn btn-outline-dark" id="btnTotal" onclick="switchView('total')">3. ì „ì²´ í†µê³„</button>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body bg-white rounded">
            <div class="row g-2 align-items-center">
                <div class="col-auto"><label class="fw-bold text-secondary">ğŸ“… ê¸°ê°„</label></div>
                <div class="col-auto"><select class="form-select form-select-sm"><option>2024ë…„</option></select></div>
                <div class="col-auto"><select class="form-select form-select-sm"><option>1Q</option></select></div>
                <div class="col-auto text-secondary">~</div>
                <div class="col-auto"><select class="form-select form-select-sm"><option>2025ë…„</option></select></div>
                <div class="col-auto"><select class="form-select form-select-sm"><option>1Q</option></select></div>

                <div class="vr mx-3"></div>

                <div class="col-auto"><label class="fw-bold text-secondary">ğŸ“¡ ë°©ì†¡ì‚¬</label></div>
                <div class="col-auto">
                    <select class="form-select form-select-sm" id="broadcasterSelect">
                        <option value="all">ì „ì²´</option>
                        <option value="ebs">EBS</option>
                        <option value="kbs">KBS</option>
                        <option value="mbc">MBC</option>
                    </select>
                </div>
                
                <div class="col-auto ms-2"><label class="fw-bold text-secondary">ğŸ“º ì±„ë„</label></div>
                <div class="col-auto">
                    <select class="form-select form-select-sm" id="channelSelect">
                        <option value="all">ì „ì²´</option>
                        <option value="ebs1">EBS 1TV</option>
                        <option value="ebs2">EBS 2TV</option>
                    </select>
                </div>

                <div class="vr mx-3"></div>

                <div class="col-auto"><label class="fw-bold text-secondary">ğŸ” í”„ë¡œê·¸ë¨</label></div>
                <div class="col-auto">
                    <input type="text" class="form-control form-control-sm" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" value="ê¸°í–‰ (Like ê²€ìƒ‰)" style="width: 150px;">
                </div>
                <div class="col-auto ms-auto">
                    <button class="btn btn-primary btn-sm px-4 fw-bold">ì¡°íšŒ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between">
            <span class="fw-bold fs-6" id="chartTitle">ğŸ“ˆ ë¶„ê¸°ë³„ ì´ ë¹„ìš© ì¶”ì„¸</span>
        </div>
        <div class="card-body">
            <div style="height: 320px;">
                <canvas id="myChart"></canvas>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span class="fw-bold fs-6" id="gridTitle">ğŸ“‹ ìƒì„¸ ë°ì´í„° ëª©ë¡</span>
            <button class="btn btn-success btn-sm">ğŸ“— ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered table-hover mb-0" id="dataTable">
                </table>
            </div>
        </div>
    </div>

    <nav id="paginationNav" class="justify-content-center">
        <ul class="pagination">
            <li class="page-item disabled"><a class="page-link" href="#">Prev</a></li>
            <li class="page-item active" id="page1"><a class="page-link" onclick="switchView('main', 1)">1</a></li>
            <li class="page-item" id="page2"><a class="page-link" onclick="switchView('main', 2)">2</a></li>            
            <li class="page-item"><a class="page-link" href="#">Next</a></li>
        </ul>
    </nav>

</div>

<script>
    let myChartInstance = null;
    const labels = ['2024.1Q', '2024.2Q', '2024.3Q', '2024.4Q', '2025.1Q'];

    // [ë°ì´í„° 1-1] ë©”ì¸: 1í˜ì´ì§€ ë°ì´í„° (ìƒìœ„ê¶Œ)
    const dataMainPage1 = [
        { name: 'í•œêµ­ê¸°í–‰', data: [100, 110, 150, 130, 140], color: '#ff6384' },
        { name: 'ì„¸ê³„í…Œë§ˆê¸°í–‰', data: [80, 85, 90, 85, 95], color: '#36a2eb' },
        { name: 'ê±´ì¶•íƒêµ¬ ê¸°í–‰', data: [50, 50, 50, 50, 55], color: '#ffce56' },
        { name: 'ì•„ì‹œì•„ ìŒì‹ ê¸°í–‰', data: [40, 42, 45, 43, 46], color: '#4bc0c0' },
        { name: 'ì—­ì‚¬ íƒë°© ê¸°í–‰', data: [30, 32, 35, 33, 34], color: '#9966ff' }
    ];

    // [ë°ì´í„° 1-2] ë©”ì¸: 2í˜ì´ì§€ ë°ì´í„° (í•˜ìœ„ê¶Œ - ì‹œë®¬ë ˆì´ì…˜ìš©)
    const dataMainPage2 = [
        { name: 'ë™ë„¤ í•œë°”í€´ ê¸°í–‰', data: [20, 22, 25, 23, 24], color: '#ff9f40' },
        { name: 'ê¸°í–‰ê³¼ ì‚¬ëŒë“¤', data: [15, 15, 18, 17, 19], color: '#9966ff' },
        { name: 'ìˆ¨ì€ ê³¨ëª© ê¸°í–‰', data: [10, 10, 12, 11, 13], color: '#4bc0c0' },
        { name: 'ì‹œì¥ ë§›ì§‘ ê¸°í–‰', data: [8, 9, 8, 9, 10], color: '#ffcd56' },
        { name: 'ë°”ë‹·ê°€ ê¸°í–‰', data: [5, 5, 5, 5, 6], color: '#36a2eb' }
    ];

    // [ë°ì´í„° 2] ìƒì„¸: ë‹¨ì¼ í”„ë¡œê·¸ë¨
    const dataDetail = [
        { name: 'ìŒì €í˜‘', data: [10, 10, 12, 11, 13], color: '#36a2eb' },
        { name: 'í•¨ì €í˜‘', data: [20, 22, 25, 23, 24], color: '#ffce56' },
        { name: 'ë¹„ì‹ íƒ', data: [60, 68, 100, 85, 90], color: '#ff6384' },
        { name: 'ì•Œìˆ˜ì—†ìŒ', data: [10, 10, 13, 11, 13], color: '#c9cbcf' }
    ];

    // [ë°ì´í„° 3] ì „ì²´: í•©ê³„
    const dataTotal = [
        { name: 'ìŒì €í˜‘', data: [500, 550, 600, 580, 650], color: '#36a2eb' },
        { name: 'í•¨ì €í˜‘', data: [1000, 1100, 1200, 1150, 1250], color: '#ffce56' },
        { name: 'ë¹„ì‹ íƒ', data: [3000, 3200, 3500, 3400, 3600], color: '#ff6384' },
        { name: 'ì•Œìˆ˜ì—†ìŒ', data: [500, 500, 600, 550, 600], color: '#c9cbcf' }
    ];

    window.onload = function() { switchView('main', 1); };

    function switchView(mode, pageNum) {
        const searchInput = document.getElementById('searchInput');
        const badge = document.getElementById('programBadge');
        const pagination = document.getElementById('paginationNav');
        const chartTitle = document.getElementById('chartTitle');
        const gridTitle = document.getElementById('gridTitle');
        const bSelect = document.getElementById('broadcasterSelect');
        const cSelect = document.getElementById('channelSelect');

        // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
        document.getElementById('btnMain').className = 'btn btn-outline-primary';
        document.getElementById('btnDetail').className = 'btn btn-outline-secondary';
        document.getElementById('btnTotal').className = 'btn btn-outline-dark';

        if (myChartInstance) myChartInstance.destroy();

        if (mode === 'main') {
            // [ëª¨ë“œ 1: í†µí•© ë¹„êµ]
            document.getElementById('btnMain').className += ' active';
            
            // UI ì„¤ì •
            searchInput.value = 'ê¸°í–‰'; 
            searchInput.disabled = false;
            bSelect.value = 'ebs';
            cSelect.value = 'ebs1';
            
            badge.style.display = 'none';
            // â˜… í˜ì´ì§• ë³´ì„!
            pagination.style.display = 'flex'; 
            
            // í˜ì´ì§€ë³„ ë°ì´í„° ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜
            let currentData = dataMainPage1;
            if (pageNum === 2) currentData = dataMainPage2;            

            // í˜ì´ì§€ ë²„íŠ¼ Active ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.page-item').forEach(el => el.classList.remove('active'));
            if(pageNum) document.getElementById('page' + pageNum)?.classList.add('active');

            chartTitle.innerText = `ğŸ“ˆ í†µí•© ë¹„ìš© ì¶”ì„¸ (ê²€ìƒ‰ê²°ê³¼: ê¸°í–‰ - ${pageNum}í˜ì´ì§€)`;
            gridTitle.innerText = 'ğŸ“‹ í”„ë¡œê·¸ë¨ë³„ ë¹„ìš© ëª©ë¡';
            
            renderChart(currentData, 'ë¶„ê¸°ë³„ ì´ ë¹„ìš© ì¶”ì„¸');
            renderTableMain(currentData);

        } else if (mode === 'detail') {
            // [ëª¨ë“œ 2: ìƒì„¸ ë¶„ì„]
            document.getElementById('btnDetail').className += ' active';
            searchInput.value = 'í•œêµ­ê¸°í–‰';
            searchInput.disabled = true;
            
            badge.style.display = 'block';
            badge.className = 'badge bg-primary rounded-pill shadow-sm';
            badge.innerHTML = 'ğŸ“º Target: í•œêµ­ê¸°í–‰';
            
            // â˜… í˜ì´ì§• ìˆ¨ê¹€!
            pagination.style.display = 'none';
            
            chartTitle.innerText = 'ğŸ“ˆ ìƒì„¸ ë¹„ëª©ë³„ ì¶”ì´ (í•œêµ­ê¸°í–‰)';
            gridTitle.innerText = 'ğŸ“‹ ë¹„ëª©ë³„ ìƒì„¸ ë°ì´í„°';

            renderChart(dataDetail, 'ë¹„ëª©ë³„ ë¹„ìš© ì¶”ì„¸');
            renderTableDetail(dataDetail);

        } else if (mode === 'total') {
            // [ëª¨ë“œ 3: ì „ì²´ í†µê³„]
            document.getElementById('btnTotal').className += ' active';
            searchInput.value = '';
            searchInput.disabled = false;
            bSelect.value = 'all';
            cSelect.value = 'all';

            badge.style.display = 'block';
            badge.className = 'badge bg-dark rounded-pill shadow-sm';
            badge.innerHTML = 'ğŸ“¡ Target: ì „ì²´ (ë°©ì†¡ì‚¬ í•©ê³„)';
            
            // â˜… í˜ì´ì§• ìˆ¨ê¹€!
            pagination.style.display = 'none';
            
            chartTitle.innerText = 'ğŸ“ˆ ë°©ì†¡ì‚¬ ì „ì²´ ë¹„ëª©ë³„ ì¶”ì´';
            gridTitle.innerText = 'ğŸ“‹ ì „ì²´ ë¹„ëª©ë³„ ë°ì´í„° í•©ê³„';

            renderChart(dataTotal, 'ì „ì²´ ë¹„ëª©ë³„ ë¹„ìš© ì¶”ì„¸');
            renderTableDetail(dataTotal);
        }
    }

    function renderChart(dataset, title) {
        const ctx = document.getElementById('myChart').getContext('2d');
        const datasets = dataset.map(item => ({
            label: item.name,
            data: item.data,
            borderColor: item.color,
            backgroundColor: item.color,
            tension: 0.2,
            borderWidth: 2,
            pointRadius: 4,
            pointHoverRadius: 6
        }));

        myChartInstance = new Chart(ctx, {
            type: 'line',
            data: { labels: labels, datasets: datasets },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: { y: { beginAtZero: true, grid: { borderDash: [2, 2] } } }
            }
        });
    }

    // ë©”ì¸ í…Œì´ë¸”
    function renderTableMain(data) {
        let html = `
            <thead class="table-light">
                <tr>
                    <th style="width: 25%">í”„ë¡œê·¸ë¨ëª…</th>
                    ${labels.map(l => `<th>${l}</th>`).join('')}
                    <th class="total-col">í•©ê³„</th>
                </tr>
            </thead>
            <tbody>
        `;
        
        if (data.length === 0) {
             html += `<tr><td colspan="7" class="text-center py-4">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr></tbody>`;
        } else {
            data.forEach(item => {
                const total = item.data.reduce((a, b) => a + b, 0);
                html += `
                    <tr>
                        <td class="fw-bold text-start ps-4">${item.name}</td>
                        ${item.data.map(d => `<td>${d}</td>`).join('')}
                        <td class="total-col">${total.toLocaleString()}ì–µ</td>
                    </tr>
                `;
            });
            html += `</tbody>`;
        }
        document.getElementById('dataTable').innerHTML = html;
    }

    // ìƒì„¸/ì „ì²´ í…Œì´ë¸”
    function renderTableDetail(data) {
        let html = `
            <thead class="table-light">
                <tr>
                    <th style="width: 25%">êµ¬ë¶„</th>
                    ${labels.map(l => `<th>${l}</th>`).join('')}
                    <th class="total-col">í•©ê³„</th>
                </tr>
            </thead>
            <tbody>
        `;
        let colTotals = new Array(labels.length).fill(0);
        let grandTotal = 0;

        data.forEach(item => {
            const total = item.data.reduce((a, b) => a + b, 0);
            grandTotal += total;
            item.data.forEach((val, i) => colTotals[i] += val);
            html += `
                <tr>
                    <td class="fw-bold text-start ps-4">${item.name}</td>
                    ${item.data.map(d => `<td>${d}</td>`).join('')}
                    <td class="total-col">${total.toLocaleString()}ì–µ</td>
                </tr>
            `;
        });

        html += `
            <tr class="total-row">
                <td class="text-start ps-4">í•©ê³„</td>
                ${colTotals.map(t => `<td>${t}</td>`).join('')}
                <td class="total-col text-primary">${grandTotal.toLocaleString()}ì–µ</td>
            </tr>
            </tbody>
        `;
        document.getElementById('dataTable').innerHTML = html;
    }
</script>

</body>
</html>